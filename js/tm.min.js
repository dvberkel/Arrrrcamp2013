/*! tm - v0.0.0 - 2013-09-24
* Copyright (c) 2013 Daan van Berkel; Licensed  */
window.util=function(){function a(a){function b(b){for(var d in b)a[d]=b[d];return c}var c={};return c.and=b,c}return{merge:a}}(),window.tm=function(){return{}}(),function(a,b){function c(a,c){this.symbol=a,this.options=c,this._left=b,this._right=b}function d(a,b){if(0===a.length)return new c(b.blank,b);var e=new c(a.slice(0,1),b),f=d(a.slice(1),b);return e._right=f,f._left=e,e}function e(a,b){this.defaults={blank:"",L:"left",R:"right"},util.merge(this.defaults).and(b),this.tape=d(a||this.defaults.blank,this.defaults)}c.prototype.read=function(){return this.symbol},c.prototype.write=function(a){this.symbol=a||this.options.blank},c.prototype.left=function(){return this._left===b&&(this._left=new c(this.options.blank,this.options),this._left._right=this),this._left},c.prototype.right=function(){return this._right===b&&(this._right=new c(this.options.blank,this.options),this._right._left=this),this._right},c.prototype.index=function(a){return 0===a?this:0>a?this.left().index(a+1):a>0?this.right().index(a-1):void 0},e.prototype.read=function(){return this.tape.read()},e.prototype.write=function(a){return this.tape.write(a)},e.prototype.left=function(){return this.tape=this.tape.left(),this},e.prototype.right=function(){return this.tape=this.tape.right(),this},e.prototype.execute=function(a){this.write(a.write),this[this.defaults[a.move]].call(this)},a.tape=function(a,b){return new e(a,b)}}(tm),function(a){function b(a,b){this._rulebook=a,this._currentState=b}b.prototype.currentState=function(){return this._currentState},b.prototype.instructionFor=function(a){var b=this._rulebook[this._currentState];if(b){var c=b[a];if(c)return c}},b.prototype.execute=function(a){this._currentState=a.nextState},a.StateMachine=b}(tm),function(a){function b(b,c,d,e){this.options={stopState:"HALT"},util.merge(this.options).and(e),this._head=new a.tape(b,this.options),this._stateMachine=new a.StateMachine(c,d),this._error=!1,this._halt=!1,this._observers=[]}b.prototype.currentState=function(){return this._stateMachine.currentState()},b.prototype.read=function(){return this._head.read()},b.prototype.step=function(a){for(a=a||1;a>0;){var b=this._stateMachine.instructionFor(this.read());b&&b.nextState===this.options.stopState?this._halt=!0:b?(this._head.execute(b),this._stateMachine.execute(b)):(this._error=!0,this._halt=!0),this.notify(),a--}},b.prototype.error=function(){return this._error},b.prototype.halted=function(){return this._halt},b.prototype.addObserver=function(a){this._observers.push(a)},b.prototype.notify=function(){this._observers.forEach(function(a){a.call(null,this)}.bind(this))},a.Machine=b}(tm),function(a,b){function c(a){return document.getElementById(a)}function d(a,b){this.parentContainer=a,this.machine=b,this.update()}function e(a,c,d){this.options={delay:1e3},util.merge(this.options).and(d),this.parentContainer=a,this.machine=c,this.interval=b,this.update()}function f(a,b,c){this.parentContainer=a,this.machine=b,this.options=c,this.update()}function g(a,b){this.parentContainer=a,this.machine=b,b.addObserver(this.update.bind(this)),this.update()}function h(a,b,c){this.parentContainer=a,this.machine=b,this.index=c,this.machine.addObserver(this.update.bind(this)),this.update()}function i(a,b,c){this.options={borderCells:2},util.merge(this.options).and(c),this.parentContainer=a,this.machine=b,this.createCells()}function j(a,b,d){this.options={},util.merge(this.options).and(d),this.container=c(a),this.controlView=new f(this.container,b,this.options),this.stateView=new g(this.container,b,this.options),this.tapeView=new i(this.container,b,this.options)}d.prototype.update=function(){var a=document.createElement("button");a.innerText="step",a.addEventListener("click",this.step.bind(this)),this.parentContainer.appendChild(a)},d.prototype.step=function(){this.machine.step()},e.prototype.update=function(){var a=this.pauzeButton();this.parentContainer.appendChild(a);var b=this.playButton();this.parentContainer.appendChild(b)},e.prototype.pauzeButton=function(){var a=document.createElement("button");return a.innerText="||",a.addEventListener("click",this.pauze.bind(this)),a},e.prototype.playButton=function(){var a=document.createElement("button");return a.innerText=">",a.addEventListener("click",this.play.bind(this)),a},e.prototype.pauze=function(){this.interval&&clearInterval(this.interval),this.interval=b},e.prototype.play=function(){this.interval||(this.step(),this.interval=setInterval(this.step.bind(this),this.options.delay))},e.prototype.step=function(){this.machine.step()},f.prototype.container=function(){return this._container||(this._container=document.createElement("div"),this._container.setAttribute("class","control"),this.parentContainer.appendChild(this._container)),this._container},f.prototype.update=function(){var a=this.container();new d(a,this.machine,this.options),new e(a,this.machine,this.options)},f.prototype.step=function(){this.machine.step()},g.prototype.container=function(){return this._container||(this._container=document.createElement("div"),this._container.setAttribute("class","state"),this.parentContainer.appendChild(this._container)),this._container},g.prototype.update=function(){var a=this.container();a.innerHTML="<span>"+this.machine.currentState()+"</span>"},h.prototype.container=function(){return this._container||(this._container=document.createElement("span"),this._container.setAttribute("class",this.classes()),this.parentContainer.appendChild(this._container)),this._container},h.prototype.update=function(){var a=this.container(),b=this.machine._head.tape.index(this.index);a.textContent=b.read()},h.prototype.classes=function(){return 0===this.index?"cell head":"cell"},i.prototype.container=function(){return this._container||(this._container=document.createElement("div"),this._container.setAttribute("class","tape"),this.parentContainer.appendChild(this._container)),this._container},i.prototype.createCells=function(){for(var a=this.container(),b=this.options.borderCells,c=-b;b>=c;c++)new h(a,this.machine,c)},a.MachineView=j}(tm);